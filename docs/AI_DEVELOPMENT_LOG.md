# NPO予算管理システム - AI開発セッション記録

> **注意**: このファイルはAI（Claude等）との開発セッションで発見した問題、解決策、進捗を記録するためのファイルです。

## 📋 現在のシステム状況

### サーバー起動設定
- **フロントエンド**: `npm run dev -- -H 0.0.0.0 -p 3001`
- **バックエンド**: 開発環境ポート8001、本番環境ポート8000
- **外部アクセス**: 160.251.170.97:3001

### 重要な注意事項
- **本番環境**: ポート8000は本番環境、権限問題あり
- **開発環境**: ポート8001で新機能開発
- **外部アクセス**: 必ず `-H 0.0.0.0` フラグ使用

## 🔧 よくあるトラブルと解決法

### フロントエンドが外部からアクセスできない
```bash
# プロセス確認
pgrep -fl "next"
# 古いプロセス停止
kill [PID]
# 正しい起動
npm run dev -- -H 0.0.0.0 -p 3001
# ポート確認
ss -tlnp | grep 3001
```

### バックエンド接続問題
- ポート8000: 本番環境（権限問題で更新困難）
- ポート8001: 開発環境（新機能対応済み）

## 📅 開発セッション記録

### 2024年1月（最新）
#### 完了済み
- [x] .cursorrules作成（プロジェクトルール整備）
- [x] AI操作ガイドライン設定
- [x] 本番環境保護ルール追加
- [x] 依存関係管理ルール追加
- [x] AI開発セッション記録の構造化
- [x] ファイル名の変更（CLAUDE.md → AI_DEVELOPMENT_LOG.md）
- [x] Cursorファイル操作ツールの使い方説明と実践
- [x] .cursorrules の包括的なルール整備完了
- [x] 本番環境操作への厳重な保護ルール追加
- [x] AI権限制限とroot操作ルールの明確化
- [x] 依存関係管理（メジャーアップデート慎重対応）ルール追加
- [x] Cursor優先操作ルールの確立
- [x] ドキュメント整理（docs/ディレクトリへの移動）
- [x] 不要ファイルの削除とプロジェクト整理
- [x] ガイド系ファイルの古い情報修正とdocs/統合

#### 今日のセッションで解決した課題
- **課題**: AIが勝手に判断して適切でない操作を行う
- **解決策**: .cursorrules で包括的なガイドライン設定
- **成果**: 本番環境保護、権限管理、ツール選択の明確化

#### 進行中
- [ ] AI_DEVELOPMENT_LOG.md の実用的な活用方法の実践

### 過去のセッション記録
#### 新しいフィールド対応（完了済み）
- [x] データベーススキーマ更新 (grant_code, remarks列追加)
- [x] バックエンドAPI更新 (main.py, schemas.py, database.py)
- [x] フロントエンド型定義更新 (api.ts)
- [x] 助成金管理ページのUI更新
- [x] CSVエクスポート機能更新
- [x] CSVインポート機能更新

#### 未解決の課題
- [ ] バックエンドの本番環境デプロイ（権限問題）
- [ ] 割当データCSVの部分アップロード機能テスト

## 🎯 今後のAIセッションでの注意点

### 必ず確認すること
1. **本番環境への影響**: ポート8000は触らない
2. **外部アクセス設定**: `-H 0.0.0.0` フラグの使用
3. **メジャーアップデート**: 事前調査と段階的実施
4. **root権限操作**: AIは実行せず、ユーザーに依頼
5. **ファイル操作**: Cursorツールを優先、ターミナルは最小限
6. **セッション記録**: 重要な成果はdocs/AI_DEVELOPMENT_LOG.mdに記録

### AIセッション終了時に更新
- 解決した問題と手順
- 新しく発見した課題
- 次回セッションへの引き継ぎ事項

---

## 📚 関連ドキュメント
- システム仕様: `docs/SYSTEM_SPECIFICATION.md`
- デプロイ手順: `docs/DEPLOY_GUIDE.md`
- 改善提案: `docs/IMPROVEMENT_PROPOSALS.md`
- AIルール: `.cursorrules` 