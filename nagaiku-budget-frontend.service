[Unit]
Description=NPO Budget Management System - Frontend (統一環境)
After=network.target nagaiku-budget-backend.service
Wants=nagaiku-budget-backend.service

[Service]
Type=simple
User=tanaka
Group=tanaka
WorkingDirectory=/home/tanaka/nagaiku-budget/frontend
# 統一環境用環境変数設定
Environment=PORT=3000
# .nextディレクトリがない場合は自動ビルド
ExecStartPre=/bin/bash -c 'if [ ! -d ".next" ]; then echo "🔨 Building Next.js app..." && npm run build; else echo "✅ Using existing build"; fi'
ExecStart=/usr/bin/npm start
Restart=always
RestartSec=10
StandardOutput=append:/home/tanaka/nagaiku-budget/logs/frontend_prod.log
StandardError=append:/home/tanaka/nagaiku-budget/logs/frontend_prod.log

# プロセス管理
KillMode=mixed
KillSignal=SIGTERM
TimeoutStopSec=30

[Install]
WantedBy=multi-user.target 