助成金の割り当ては、予算項目ごとで
データをダウンロードできるようにしたい
金額は、全部カンマを付けて
メニューはドロップダウンじゃなくて、最初から見えるように
取引割り当ては、一覧表にして、割り当て助成金は一番左。ドロップダウンで選べるように。

## 実装進捗状況

### ✅ システム整理・シンプル化完了（2024年12月）

#### **🔧 削除・簡素化済み機能**
- **Excel風取引一覧** → 削除
- **割り当て後の表** → 削除  
- **システム初期化ポップアップ** → 削除
- **詳細な割り当てモード** → 削除
- **高度なフィルター・並べ替え機能** → 削除
- **分散していたダウンロード機能** → 一箇所に集約

#### **✅ 残存・改善済み機能**
- **簡単な割り当て（表から直接編集）** → メイン機能として最適化
- **取引ID** → 列の最後に移動
- **基本読み込み** → 起動時自動化
- **【事】【管】フィルタリング** → 基本機能として維持

#### **🆕 新規追加機能**
- **データダウンロードページ** → 全てのダウンロード・アップロード・管理機能を集約
- **CSV アップロード機能** → 助成金・割り当てデータのExcel編集後アップロード対応
- **自動読み込み機能** → 助成金・割り当てデータの起動時自動読み込み

### ✅ 第1段階完了項目（過去実装）

⑦取引IDの実装 ✅完了
- 「仕訳番号_仕訳行番号」形式の取引IDを実装
- 既存のハイフン区切り（5040101-1）からアンダースコア区切り（5040101_1）へ対応

⑩助成金予算項目ID実装 ✅完了  
- 助成金予算項目に予算項目ID（GRANT{助成金ID}_ITEM{項目番号}）を付与
- 取引IDと予算項目IDの関連付けデータ構造を実装
- CSVファイル保存・読み込み機能対応（互換性維持）

🆕部分金額割り当て機能 ✅完了
- 取引金額の一部のみを助成金に割り当てる機能
- 例：1万円の取引で8000円のみ割り当て
- 割り当て金額と取引金額を分離管理

🆕助成金単位の割り当て廃止 ✅完了
- 予算項目からのみ割り当て可能に変更
- UIから助成金単位選択を削除

🆕【事】【管】フィルタリング ✅完了
- 借方勘定科目が【事】【管】で始まる取引のみ表示
- データの絞り込みで対象外取引を除外

### 🎉 **シンプル統合システム完成！**

**NPO法人助成金管理システムが使いやすく整理されました**

#### **📋 現在の主要機能**
1. **📊 ダッシュボード** - システム概要と統計表示
2. **📂 freee データアップロード** - 必要時のみ取引データアップロード  
3. **💰 助成金予算管理** - 助成金・予算項目の登録管理
4. **🔗 取引割り当て** - シンプルな表形式での直接編集（100%割り当て）
5. **📈 分析・レポート** - 予算執行状況の分析・可視化
6. **💾 データダウンロード** - 全データの一括ダウンロード・アップロード・管理

#### **🚀 使いやすさの向上点**
- **起動が高速** - 自動読み込みで即座に利用開始
- **操作が簡単** - 表から直接予算項目選択で100%割り当て
- **管理が容易** - データ操作を一箇所に集約
- **Freeeデータ** - 必要時のみアップロード、データ蓄積方式
- **Excel連携** - CSVでデータを編集してアップロード可能

### 🔮 将来実装予定項目

💡一括割り当て機能（実装済み機能の拡張）
- 簡単な割り当てモードでの複数取引の一括処理
- 条件指定による自動割り当て
- フィルター機能との連携
- バッチ処理による効率化

💡レポート機能の強化
- PDF出力機能
- グラフ表示の詳細化
- 予算執行状況の可視化

💡データ連携機能
- freee API連携
- 自動データ更新
- クラウドストレージ連携

## データ構造変更情報
- 割り当てデータ: 文字列 → 辞書形式（grant_name, budget_item_id, amount, transaction_amount）
- 助成金データ: 予算項目にid フィールド追加
- CSVファイル: 新旧形式の互換性を維持
- 取引ID: 列位置を最後に移動
- UI: シンプルな割り当てのみに集約


簡単な割り当て（表から直接編集）
✅複数条件の並べ替えと、フィルター設定を付けて欲しい
✅取引日・借方部門・借方勘定科目・借方金額・借方取引先名・借方備考・借方メモは項目に必要
✅割り当て後の、予算項目データごとの一覧は欲しい


✅割り当て・助成金データはダウンロードもしたい（いま、保存だけだと思う・・・）
✅取引データは、毎回変わるわけではないので、アプリで保存しておいて欲しい
✅アップロードしたときだけ、上書き保存みたいな

### ✅ 第2段階完了項目（2024年12月実装）

#### **🔍 取引表示・フィルタリング機能強化**
- **取引表示項目の拡張** ✅完了
  - 借方取引先名、借方備考、借方メモを表示項目に追加
  - 取引情報の詳細表示が可能に

- **高度なフィルター機能** ✅完了
  - 取引日範囲フィルター（日付選択）
  - 借方部門フィルター（複数選択可能）
  - 借方勘定科目フィルター（複数選択可能）
  - 金額範囲フィルター（スライダー操作）

- **複数条件での並べ替え機能** ✅完了
  - 最大3段階の並べ替え条件設定
  - 昇順・降順の選択可能
  - 数値・日付の適切な並べ替え処理

#### **📊 予算項目別詳細レポート機能**
- **予算執行状況の詳細表示** ✅完了
  - 予算額・割り当て額・残額・執行率の表示
  - 予算項目別の割り当て取引一覧
  - 取引詳細情報の表示（取引日、部門、勘定科目、取引先名、備考、メモ等）

- **予算項目別CSVエクスポート** ✅完了
  - 選択した予算項目の詳細データをCSVダウンロード
  - ファイル名に日時を自動付与

#### **💾 データ永続化機能**
- **取引データの自動保存・読み込み** ✅完了
  - 起動時の取引データ自動読み込み
  - freeeデータアップロード時の自動保存
  - transactions_data.csv として永続化

- **アップロード時の上書き・追加選択** ✅完了
  - 既存データ有無の自動判定
  - 上書きインポート・追加インポートの選択可能
  - 重複データの自動除去

#### **📥 ダウンロード機能の改善**
- **保存・ダウンロード機能の分離** ✅完了
  - ファイルに保存：ローカルファイルとして保存
  - CSVダウンロード：ブラウザ経由でダウンロード
  - タイムスタンプ付きファイル名の自動生成

- **全データ対応** ✅完了
  - 助成金データのダウンロード機能追加
  - 割り当てデータのダウンロード機能追加
  - 取引データの保存機能追加


20250701_13:04
【助成金管理】
予算項目IDを、シンプルにしたいな数字だけで良いかも
予算項目設定の、予算項目数って必要そう？
総予算額は、予算項目の合計で良いな
助成元はいらないかな
予算項目に、説明が欲しい（選ぶときの目安に）

金額は、すべてカンマと右揃えで


【取引割り当て】
フィルターや並べ替えは、他にスマートな方法があったら教えて
取引割り当て表示（AgGrid版）の「現在の割り当て」項目から、割り当てができるようにして欲しい
以前の 割り当て編集はできたら消したい

 20250701_13:33
 取引一覧（全件表示）
 ひだり列は、もう少し狭くして取引一覧の幅を広くしたい
 取引IDは、固定表示にしなくてOK
 助成金情報などの行間を狭くして、もう少し全体が見やすいように
 取引割り当てのような、複数の並べ替えとフィルターが欲しい
 できたら、助成金予算項目情報の方も一覧表形式にして、チェックした物を取引情報に一括で割り当てられる・・・みたいにしたい

20250701_17:57
一括取引割り当て
選択した予算項目を割り当てられている取引のバックに色を付けたい
取引割り当てのような、複数の並べ替えとフィルターが欲しい
取引一覧に、Pagesizeが欲しい
チェックした借方金額の合計を出したい
もう少し、取引一覧の文字を小さくしたい

20250702_10:28
